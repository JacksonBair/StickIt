(()=>{"use strict";let e=null,o=[];function t(t){const l=function(t){const l=document.createElement("div");l.className="note-host",l.style.position="absolute",l.style.top=`${t.position.top}px`,l.style.left=`${t.position.left}px`,l.style.width="200px",l.style.height="150px",l.style.zIndex="2147483646";const i=l.attachShadow({mode:"open"}),s=document.createElement("div");s.innerHTML=t.innerhtml.trim(),s.style.backgroundColor=t.color,s.style.padding="10px",s.style.borderRadius="5px",s.style.boxShadow="0 2px 5px rgba(0, 0, 0, 0.3)";const r=document.createElement("div");r.style.width="50px",r.style.height="5px",r.style.marginTop="5px",r.style.marginBottom="5px",r.style.backgroundColor="grey",r.style.borderRadius="10px",r.style.position="absolute",r.style.top="5px",r.style.left="50%",r.style.transform="translateX(-50%)",r.style.cursor="grab",r.style.zIndex="2147483647",s.appendChild(r);const d=s.querySelector(".note-content");d&&(d.value=t.text,d.style.width="100%",d.style.height="100px",d.style.backgroundColor=t.color,d.style.border="none",d.style.resize="none",d.style.outline="none",d.style.color="black",d.addEventListener("input",(()=>{n()})));const a=s.querySelector(".close-note");return a&&(a.style.position="absolute",a.style.top="5px",a.style.right="5px",a.style.backgroundColor=t.color,a.style.color="black",a.style.border="none",a.style.borderRadius="50%",a.style.width="20px",a.style.height="20px",a.style.cursor="pointer"),i.appendChild(s),document.body.appendChild(l),function(e){var t;const n=null===(t=e.shadowRoot)||void 0===t?void 0:t.querySelector(".close-note");n&&n.addEventListener("click",(()=>{const t=e.getAttribute("data-note-id");if(t){chrome.storage.local.remove(t,(()=>{console.log(`Note id: ${t} removed from storage.`)})),document.body.removeChild(e);const n=o.findIndex((e=>e.id===t));-1!==n&&o.splice(n,1)}}))}(l),function(o,t){let l,i,s=!1;o.addEventListener("mousedown",(e=>{l=e.clientX-t.getBoundingClientRect().left,i=e.clientY-t.getBoundingClientRect().top,s=!0,o.style.cursor="grabbing"})),document.addEventListener("mousemove",(o=>{if(s){const n=o.clientX-l+window.scrollX,s=o.clientY-i+window.scrollY;t.style.left=`${n}px`,t.style.top=`${s}px`,e===t.getAttribute("data-note-id")&&c(t)}})),document.addEventListener("mouseup",(()=>{s&&(s=!1,o.style.cursor="grab",c(t),n())}))}(r,l),l.addEventListener("click",(()=>{e=t.id,c(l)})),l}(t);l.setAttribute("data-note-id",t.id),document.body.appendChild(l)}function n(){o.forEach((e=>{const o=document.querySelector(`[data-note-id="${e.id}"]`);if(o){const t=o.shadowRoot,n=null==t?void 0:t.querySelector(".note-content");n&&(e.text=n.value.trim());const l=o.getBoundingClientRect();e.position={top:l.top+window.scrollY,left:l.left+window.scrollX}}})),l()}function l(){const e={};o.forEach((o=>{e[o.id]=o})),chrome.storage.local.set(e,(()=>{console.log("Notes have been saved:",e)}))}function i(){if(document.querySelector(".toolbar"))return void console.log("Toolbar already exists. Skipping injection.");const i=document.createElement("div");i.className="toolbar",i.style.position="absolute",i.style.display="none",i.innerHTML='\n        <button id="iconOne"><img src="https://lh3.googleusercontent.com/pw/AP1GczN-DpPVU7JHUW8SjuCdo7DGznZVjj7Kjefci_1Mv23meMMoU5MhT3LADKU-uxUtcpY7oEXuxgXxP5l_x30qps5BU6gT3MEqEA2X8ascxKgEH4kXJSu6E6YeRHz6Vljv-qMFOhRoczxnW8aS4j6W_Lvq9A=w28-h28-s-no-gm?authuser=0" alt="icon" /></button>\n        <button id="iconTwo"><img src="https://lh3.googleusercontent.com/pw/AP1GczMsy3w6gWVwnjJRZazZig0vllcuCLZ2I7eNq855K2kZ8AF78vQQuLD08JeGPsvnm10di_9r2wr1sEs44zUATv6lJPI0cXEJB89M2BfnDooTO-1F7jDpB7ipZn4Zj8O9o6yI_mrpsHOZmkfQm6bQcan5iA=w20-h21-s-no-gm?authuser=0" alt="icon" /></button>\n        <button id="iconThree"><img src="https://lh3.googleusercontent.com/pw/AP1GczPG2tQ85a5crHpW_wmfY1hYH4nlBLJghbQ0EBNCeW7NLzY4bHXCd-dfnttLkYETXT1Om9VYM2mErg5PS9z9_6nIF-y9GayZVLnf3ijgkFURGV7OW5_24XbTYVsb3TXJ7L6_gekP2wZyWc6i-oY12rA4JQ=w25-h25-s-no-gm?authuser=0" alt="icon" /></button>\n        <button id="iconFour">\n            <div class="circle" style="width: 20px; height: 20px; background-color: #cb2b9b; border-radius: 50%;"></div>\n        </button>\n        <input type="color" id="colorPicker" style="display: none;" />\n        <button id="iconFive"><img src="https://lh3.googleusercontent.com/pw/AP1GczP3ClMcaB8B9roVfM6isgXQbU89122IPIAkV6zqVHYL-tmXtkKRuNw71HcuBlloJ2Vos4A8YRf00BszMXatJkd586K7WGUDqDBUXYVCPX5qi0SNzW92F8NIEfyeaOv8xfnSyJxW1U24Eh5cBgrD5iGvug=w20-h19-s-no-gm?authuser=0" alt="icon" /></button>\n        <button id="iconSix"><img src="https://lh3.googleusercontent.com/pw/AP1GczPyAgWHA6YU862EKjCaMnOOWN1Al0XvYgkI1dF7MHcRerJJLvRAVyg-oyTDNu5O80pZ6JRoVI4J4tOjNM2Ny8yWtdGyEJdGODDISGXFXoOAot2_DOEYtITrfY7Ow9X-TL0o5LsjGGEWuXxmiBfDqm7UFg=w20-h20-s-no-gm?authuser=0" alt="icon" /></button>\n        <button id="iconSeven"><img src="https://lh3.googleusercontent.com/pw/AP1GczOXOaZPfVnrtYqqYk_GH8xxcgQmRaT1oZ7uFSUi-sOXuKeLL6VQg24rK8_HfnQLYcXPTraX9Nw3ApjpX-IHZm-7EG4xk9hKZMxyI-AALjz5adj7zNne-aVx8DkKP7xZFfgK9jA0TpTBNoN8I4TDWIoUoQ=w17-h25-s-no-gm?authuser=0" alt="icon" /></button>\n    ',document.body.appendChild(i);const c=document.createElement("style");c.innerHTML="\n        .toolbar {\n            display: flex;\n            flex-direction: column;\n            flex-wrap: nowrap;\n            position: absolute;\n            z-index: 2147483647;\n            background-color: #FFFFFF;\n            filter: drop-shadow(0 0 0.4rem black);\n            height: 300px;\n            width: 35px;\n            border-radius: 10px;\n            row-gap: 10px;\n            justify-content: center;\n            align-items: center;\n            padding: 5px;\n            transform: scale(0.85);\n            margin-top: -65px;\n        }\n    \n        .toolbar button {\n            background: none;\n            border: none;\n            padding: 0;\n            margin: 0;\n            font: inherit;\n            color: inherit;\n            cursor: pointer;\n            outline: none;\n        }\n    ",document.head.appendChild(c),console.log("Toolbar injected"),function(i){var c,s,r,d,a,u;const p=document.getElementById("iconFour"),g=document.getElementById("colorPicker");document.addEventListener("click",(o=>{const t=o.target.closest(".note-host");if(t){e=t.getAttribute("data-note-id");const o=t.getBoundingClientRect();i.style.top=`${o.top}px`,i.style.left=o.left+window.scrollX-i.offsetWidth-10+"px",i.style.display="flex",console.log(`Toolbar shown for note ID: ${e}`)}else p.contains(o.target)?i.style.display="flex":i.style.display="none"})),null===(c=i.querySelector("#iconOne"))||void 0===c||c.addEventListener("click",(()=>{console.log("Move icon clicked")})),null===(s=i.querySelector("#iconTwo"))||void 0===s||s.addEventListener("click",(()=>{console.log("Text icon clicked")})),null===(r=i.querySelector("#iconThree"))||void 0===r||r.addEventListener("click",(()=>{console.log("Eraser icon clicked"),function(){const e=new URL(window.location.href).hostname,t=o.filter((o=>o.url===e));if(window.confirm("Are you sure you want to erase all notes on this page?")){t.forEach((e=>{const o=document.querySelector(`[data-note-id="${e.id}"]`);o?(document.body.removeChild(o),console.log(`Note with ID: ${e.id} removed from DOM.`)):console.log(`Note element with ID: ${e.id} not found in DOM.`)})),o=o.filter((o=>o.url!==e)),console.log("Updated noteList:",o);const n=t.map((e=>e.id));chrome.storage.local.remove(n,(()=>{console.log("All notes for this page cleared from storage."),l()}))}else console.log("Clear action canceled by the user")}()})),p.addEventListener("click",(()=>{console.log("Circle icon clicked"),g.style.display="block",g.style.position="absolute",g.style.borderRadius="50%",g.style.width="30px",g.style.height="30px",g.click()})),g.addEventListener("input",(l=>{const i=l.target.value;if(console.log("Color picked:",i),e){const l=document.querySelector(`[data-note-id="${e}"]`);if(l){const c=l.shadowRoot,s=null==c?void 0:c.querySelector(".note-content");s&&(s.style.backgroundColor=i);const r=o.find((o=>o.id===e));if(r){r.color=i,n();const c=o.findIndex((o=>o.id===e));-1!==c&&(document.body.removeChild(l),t(o[c]))}}}g.style.display="none"})),null===(d=i.querySelector("#iconFive"))||void 0===d||d.addEventListener("click",(()=>{console.log("Undo icon clicked")})),null===(a=i.querySelector("#iconSix"))||void 0===a||a.addEventListener("click",(()=>{console.log("Redo icon clicked")})),null===(u=i.querySelector("#iconSeven"))||void 0===u||u.addEventListener("click",(()=>{console.log("Save icon clicked")}))}(i)}function c(e){const o=document.querySelector(".toolbar"),t=e.getBoundingClientRect();o.style.top=`${t.top+window.scrollY}px`,o.style.left=t.left+window.scrollX-o.offsetWidth-10+"px",o.style.display="flex"}window.hasCreateNoteListener||(window.hasCreateNoteListener=!0,chrome.runtime.onMessage.addListener(((e,l,c)=>{if("createNote"===e.action)return function(e){const l={id:Math.random().toString(36).substr(2,9),color:e,position:{top:100,left:700},innerhtml:'\n            <div class="note" style="padding: 10px;">\n                <textarea class="note-content"></textarea>\n                <button class="close-note">X</button>\n            </div>\n        ',text:"StickIt",url:new URL(window.location.href).hostname};i(),t(l),o.push(l),n()}(e.color),console.log("New Note Injected"),c({success:!0}),!0}))),chrome.runtime.onMessage.addListener(((e,n,l)=>{"retrieveNote"===e.action&&(console.log("RetrieveNote is running"),chrome.storage.local.get(null,(e=>{const n=Object.values(e),l=new URL(window.location.href).hostname;i();const c=n.filter((e=>e.url===l));c.forEach((e=>{o.push(e),t(e)})),console.log("Notes retrieved for this page:",c),console.log(o)})))}))})();